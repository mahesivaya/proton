<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
      font-family: Arial, sans-serif;
      background: #f6f7fb;
      text-align: center;
      padding: 40px;
    }
    .chart-container {
      width: 80%;
      max-width: 800px;
      margin: auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h2 {
      margin-bottom: 20px;
      color: #333;
        form { margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #f5f5f5; }
    </style>
</head>
<body>
    <a href="{% url 'redirect_to_home' %}" class="btn btn-primary">üè† Back to Home</a>
    <form method="POST" action="{% url 'patient_filter_form' %}">
        {% csrf_token %}
        <label>
            Year:
            <input type="number" name="year" min="2024" max="2100" required>
        </label>
        <label>
            Month:
            <input type="number" name="month" min="1" max="12" required>
        </label>
        <button type="submit">Filter</button>
    </form>
    <div class="chart-container">
        <h2>Patient Registrations Per Month</h2>
        <canvas id="patientChart"></canvas>
      </div>
{% if patients %}
        <h2>Patients for {{ year }}-{{ month|stringformat:"02d" }}</h2>
        <table>
            <thead>
                <tr>
                    <th>Patient ID</th>
                    <th>Name</th>
                    <th>Registered At</th>
                    <th>Fee Paid</th>
                </tr>
            </thead>
            <tbody>
                {% for p in patients %}
                <tr>
                    <td>{{ p.patient_id }}</td>
                    <td>{{ p.first_name }} {{ p.last_name }}</td>
                    <td>{{ p.registered_at|date:"Y-m-d H:i" }}</td>
                    <td>{{ p.fee }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% elif year and month %}
        <p>No patients found for {{ year }}-{{ month|stringformat:"02d" }}.</p>
    {% endif %}

    <script>
        const labels = {{ labels|safe }};
        const data = {{ values|safe }};
    
        const ctx = document.getElementById('patientChart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Patients Registered',
              data: data,
              borderWidth: 1,
              backgroundColor: 'rgba(75, 192, 192, 0.5)',
              borderColor: 'rgba(75, 192, 192, 1)',
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true, position: 'top' },
              title: {
                display: true,
                text: 'Monthly Patient Registrations',
                font: { size: 18 }
              }
            },
            scales: {
              y: { beginAtZero: true, title: { display: true, text: 'Patients' } },
              x: { title: { display: true, text: 'Month' } }
            }
          }
        });
      </script>
</body>
</html>