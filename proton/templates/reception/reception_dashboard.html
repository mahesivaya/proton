{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto py-6">

  <!-- Header / Navigation -->
  <div class="flex justify-between items-center mb-6">
    <a href="{% url 'reception_dashboard' %}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      ğŸ  Home
    </a>
    <button onclick="window.location.href='{% url 'chat' %}'"
            class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
      ğŸ’¬ Doctor Chat
    </button>
  </div>

  <!-- Welcome Message -->
  <div class="bg-white shadow-md p-4 rounded mb-6 text-center">
    <h2 class="text-xl font-bold mb-2">Welcome, {{ request.user.username }}!</h2>
    <p class="text-gray-600">Reception Dashboard</p>
  </div>

  <!-- Register New Patient -->
  <div class="bg-white shadow-md p-6 rounded mb-8">
    <h3 class="text-lg font-semibold mb-4">ğŸ“ Register New Patient</h3>
    <form method="POST" enctype="multipart/form-data" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {% csrf_token %}
      <label>
        <span>First Name</span>
        <input type="text" name="first_name" required class="w-full border rounded px-2 py-1">
      </label>
      <label>
        <span>Last Name</span>
        <input type="text" name="last_name" required class="w-full border rounded px-2 py-1">
      </label>
      <label>
        <span>Age</span>
        <input type="number" name="age" required class="w-full border rounded px-2 py-1">
      </label>
      <label>
        <span>Gender</span><br>
        <input type="radio" name="gender" value="Male" required> Male
        <input type="radio" name="gender" value="Female" required> Female
      </label>
      <label>
        <span>Email</span>
        <input type="email" name="email" class="w-full border rounded px-2 py-1">
      </label>
      <label>
        <span>Phone</span>
        <input type="text" name="phone_number" required class="w-full border rounded px-2 py-1">
      </label>
      <label>
        <span>Address</span>
        <input type="text" name="address" class="w-full border rounded px-2 py-1">
      </label>
      <label>
        <span>Visit Reason</span>
        <input type="text" name="visit_reason" class="w-full border rounded px-2 py-1">
      </label>
      <label>
        <span>Referral</span>
        <input type="text" name="referral" class="w-full border rounded px-2 py-1">
      </label>
      <label>
        <span>Fee</span>
        <input type="number" name="fee" class="w-full border rounded px-2 py-1">
      </label>
      <div class="md:col-span-2">
        <input type="submit" value="Register" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      </div>
    </form>
  </div>

  <!-- Search Old Patients -->
  <div class="bg-white shadow-md p-6 rounded mb-8">
    <h3 class="text-lg font-semibold mb-4">ğŸ” Search Old Patients</h3>
    <form method="get" action="{% url 'reception_dashboard' %}" class="flex gap-2">
      <input type="text" name="q" placeholder="Search by Patient ID"
             value="{{ request.GET.q }}" class="border rounded px-2 py-1 flex-grow">
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        Search
      </button>
    </form>

    {% if searchpatients %}
      <ul class="mt-4">
        {% for patient in searchpatients %}
          <li class="border-b py-2">
            {{ patient.patient_id }} - {{ patient.first_name }} {{ patient.last_name }}
            <a href="{% url 'schedule_appointment' patient.patient_id %}"
               class="ml-4 bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700">
              Add to Appointment
            </a>
          </li>
        {% endfor %}
      </ul>
    {% elif request.GET.q %}
      <p class="text-gray-500 mt-4">No patients found.</p>
    {% endif %}
  </div>

  <!-- Registered Patients Table -->
  <div class="bg-white shadow-md p-6 rounded mb-8 overflow-x-auto">
    <h3 class="text-lg font-semibold mb-4">ğŸ‘©â€âš•ï¸ Registered Patients</h3>
    <table class="min-w-full border">
      <thead class="bg-blue-100">
        <tr>
          <th class="border px-2 py-1">ID</th>
          <th class="border px-2 py-1">Name</th>
          <th class="border px-2 py-1">Age</th>
          <th class="border px-2 py-1">Registered On</th>
          <th class="border px-2 py-1">Details</th>
          <th class="border px-2 py-1">Appointment</th>
        </tr>
      </thead>
      <tbody>
        {% for patient in recent_patients %}
          <tr>
            <td class="border px-2 py-1">{{ patient.patient_id }}</td>
            <td class="border px-2 py-1">{{ patient.first_name }} {{ patient.last_name }}</td>
            <td class="border px-2 py-1">{{ patient.age }}</td>
            <td class="border px-2 py-1">{{ patient.registered_at|date:"Y-m-d H:i" }}</td>
            <td class="border px-2 py-1">
              <a href="{% url 'patient_details' patient.patient_id %}"
                 class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">View</a>
            </td>
            <td class="border px-2 py-1">
              {% if patient.patient_id in have_appointments %}
                <button class="bg-gray-400 text-white px-2 py-1 rounded" disabled>Added</button>
              {% else %}
                <a href="{% url 'schedule_appointment' patient.patient_id %}"
                   class="bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700">Add</a>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-center py-2 text-gray-500">No patients registered yet.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Scheduled Appointments -->
  <div class="bg-white shadow-md p-6 rounded">
    <h3 class="text-lg font-semibold mb-4">ğŸ“… Appointments Scheduled</h3>
    <table class="min-w-full border">
      <thead class="bg-blue-100">
        <tr>
          <th class="border px-2 py-1">Patient ID</th>
          <th class="border px-2 py-1">Date & Time</th>
        </tr>
      </thead>
      <tbody>
        {% for appointment in all_appointments %}
          <tr>
            <td class="border px-2 py-1">{{ appointment.patient.patient_id }}</td>
            <td class="border px-2 py-1">{{ appointment.appointment_date }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="2" class="text-center py-2 text-gray-500">No appointments yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="text-center mt-10">
    <a href="{% url 'logout' %}" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
      ğŸšª Logout
    </a>
  </div>

</div>
{% endblock %}

